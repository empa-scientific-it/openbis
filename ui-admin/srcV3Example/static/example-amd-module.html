<!DOCTYPE html>
<html lang="en">
  <head>
    <title>V3 API bundle test</title>

    <!-- AMD (RequireJS) version of the API -->

    <script
      type="text/javascript"
      src="http://localhost:8888/openbis-test/resources/api/v3/config.js"
    ></script>
    <script
      type="text/javascript"
      src="http://localhost:8888/openbis-test/resources/api/v3/require.js"
    ></script>

    <script>
      function useV3API() {
        require([
          'openbis',
          'as/dto/space/search/SpaceSearchCriteria',
          'as/dto/space/fetchoptions/SpaceFetchOptions'
        ], function (openbis, SpaceSearchCriteria, SpaceFetchOptions) {
          var facade = new openbis(
            'http://localhost:8888/openbis/openbis/rmi-application-server-v3.json'
          )

          facade
            .login('admin', 'password')
            .done(function (sessionToken) {
              return facade
                .searchSpaces(
                  new SpaceSearchCriteria(),
                  new SpaceFetchOptions()
                )
                .done(function (searchResult) {
                  alert(
                    'Found spaces: ' +
                      searchResult.getObjects().map(function (space) {
                        return space.getCode()
                      })
                  )
                })
            })
            .fail(error => {
              alert('Failed with error: ' + JSON.stringify(error))
            })
        })
      }
    </script>
  </head>
  <body>
    <div id="root">
      <button onclick="{useV3API();}">Use AMD V3 API</button>
    </div>
  </body>
</html>
